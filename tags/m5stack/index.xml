<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>M5Stack on Defios Lab.</title>
    <link>https://DefiosLab.github.io/tags/m5stack/</link>
    <description>Recent content in M5Stack on Defios Lab.</description>
    <generator>Hugo</generator>
    <language>jp</language>
    <lastBuildDate>Sat, 24 Dec 2022 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://DefiosLab.github.io/tags/m5stack/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>M5Stackで高速なセンシングを目指したら苦労した話</title>
      <link>https://DefiosLab.github.io/post/high_speed_sensing_m5/</link>
      <pubDate>Sat, 24 Dec 2022 00:00:00 +0000</pubDate>
      <guid>https://DefiosLab.github.io/post/high_speed_sensing_m5/</guid>
      <description>&lt;p&gt;この記事は「IoTLT Advent Calendar 2022」の23日目です。&lt;/p&gt;&#xA;&lt;p&gt;&#xA;&lt;div class=&#34;iframely-embed&#34;&gt;&lt;div class=&#34;iframely-responsive&#34; style=&#34;height: 140px; padding-bottom: 0;&#34;&gt;&lt;a href=&#34;https://qiita.com/advent-calendar/2022/iotlt&#34; data-iframely-url=&#34;//iframely.net/yfMRalm?card=small&#34;&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;script async src=&#34;//iframely.net/embed.js&#34;&gt;&lt;/script&gt;&#xA;&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h1 id=&#34;1m5stackっていいよね&#34;&gt;1．M5Stackっていいよね&lt;/h1&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://docs.m5stack.com/en/core/basic_v2.6&#34;&gt;M5Stack&lt;/a&gt;とは、ESP32を搭載したマイコンモジュールで、モノによりますが最初から液晶付いてるし、ボタン付いてるし、スピーカー/マイク、IMUなど初期搭載センサー山盛りで、Wi-FiやBluetoothまで繋がっちゃうというめっちゃ便利な開発機です。&lt;br&gt;&#xA;便利さもさることながら、今まで私がIoT工作でよく使っていたRaspberryPiは最近個人では入手しづらいですが、M5Stackは安定して売っています！欲しいなって思ったときに秋葉原で買えます。&lt;br&gt;&#xA;そんな入手し安さも相まって、最近は業務の製品開発でも使ったりお気に入りになりつつあるデバイスです。&lt;/p&gt;&#xA;&lt;blockquote class=&#34;twitter-tweet&#34;&gt;&lt;p lang=&#34;zxx&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://t.co/iZlu48cwvr&#34;&gt;pic.twitter.com/iZlu48cwvr&lt;/a&gt;&lt;/p&gt;&amp;mdash; 大将(Taisyo) (@T_taisyou) &lt;a href=&#34;https://twitter.com/T_taisyou/status/1605532841516838912?ref_src=twsrc%5Etfw&#34;&gt;December 21, 2022&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&#xA;&lt;hr&gt;&#xA;&lt;h1 id=&#34;2-m5stackを本格的に使いたかった&#34;&gt;2. M5Stackを本格的に使いたかった&lt;/h1&gt;&#xA;&lt;p&gt;M5StackはIoT入門教材にも使われたり、個人的には初心者の勉強向きかなとも思っていたんですが「画面も付いてるし、SDスロット付いてるし、中身ESP32だし、これをベースに組み込みシステム作ってもいいんじゃない？」ということで今までPICとかAVRとかPSoCとかをベースにマイコンから基板起こしてLCDやSDカードドライバなどを自分で書いていたようなシステムのベースをこれに置き換えて、もっと開発を簡単にしよう！と本格的な使用を検討することになりました。&lt;/p&gt;&#xA;&lt;p&gt;ということで、自作したコントローラーの入力でロボットを操作することを想定して、単純にA/Dで入力した値をそのままD/Aで出すデバイスを試しに作ってみようと思いました。&lt;br&gt;&#xA;M5StackにはSDカードスロットや液晶が付いてるので、操作記録をSDに記録したり、今のロボットのパワー出力を画面にかっこよく表示させることも将来的にできるかなと思ってベースにM5を選んでみました。&lt;br&gt;&#xA;&lt;figure&gt;&lt;img src=&#34;https://DefiosLab.github.io/post/high_speed_sensing_m5/machine_robot_contest.png&#34; width=&#34;200px&#34;&gt;&#xA;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;仕様としては、コントローラ操作(アナログスティックとか)の細かい動きや素早い動きでも反応良くしたかったのと、&#xA;処理内容としては「ADCで値を取得して、ちょっと計算して、DACで出すだけ」というマイコンにやらせる仕事にしてはとても簡単だったので&lt;strong&gt;希望動作周期は1kHz&lt;/strong&gt;としました。&lt;br&gt;&#xA;PICマイコンならもっとセンサーやタスクが多くてもこれぐらいの速度でADC-&amp;gt;DACできたし、ESP32がコアのM5Stackならバッチリっでしょ。と思っていました。&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h1 id=&#34;3-adcdacに何を使うか&#34;&gt;3. ADC/DACに何を使うか&lt;/h1&gt;&#xA;&lt;p&gt;M5Stack Base V2.6の場合、GPIOで使えるADC, DACはそれぞれ2個ずつで、&#xA;扱える電圧は0~3.3V、分解能は12bitで「もうちょっと分解能欲しいときもあるかもだけど、とりあえずまぁいいかなぁ」と思っていたんですが、個体差あるかもしれませんがどうやらノイズが凄いらしいという情報もいくつかあったので、内蔵AD/DAは使わない方向で作ることにしました。&lt;/p&gt;&#xA;&lt;blockquote class=&#34;twitter-tweet&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;ESP32のADC、元々電圧範囲真ん中以外かなり線形性悪かったような気がします。M5Stack固有でさらにノイズ乗ってる可能性も高いです。&lt;/p&gt;&amp;mdash; Kenta IDA (@ciniml) &lt;a href=&#34;https://twitter.com/ciniml/status/1235201261605019648?ref_src=twsrc%5Etfw&#34;&gt;March 4, 2020&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;br&gt;&#xA;&lt;p&gt;M5Stackといえばユニット(センサーなど)がケーブル1本接続するだけで簡単に使えるのが特徴の一つです。&lt;br&gt;&#xA;探してみたらADC/DACモジュールもあったので &lt;strong&gt;「これをM5に ちょいと くっつけて、 さっ とコード書いたらもう完成じゃん！！」&lt;/strong&gt; とM5の便利さに興奮しつつADC/DACはこれを使うことにしました。&lt;br&gt;&#xA;ADCは0〜12V検出で最大分解能16bit、DACは最大分解能12bitで出力電圧0〜3.3Vです。&lt;/p&gt;&#xA;&lt;div class=&#34;iframely-embed&#34;&gt;&lt;div class=&#34;iframely-responsive&#34; style=&#34;height: 140px; padding-bottom: 0;&#34;&gt;&lt;a href=&#34;https://www.switch-science.com/products/5221&#34; data-iframely-url=&#34;//iframely.net/4Ej4DFw&#34;&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;script async src=&#34;//iframely.net/embed.js&#34;&gt;&lt;/script&gt;&#xA;&lt;div class=&#34;iframely-embed&#34;&gt;&lt;div class=&#34;iframely-responsive&#34; style=&#34;height: 140px; padding-bottom: 0;&#34;&gt;&lt;a href=&#34;https://www.switch-science.com/products/5222&#34; data-iframely-url=&#34;//iframely.net/u9ne4bm&#34;&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;script async src=&#34;//iframely.net/embed.js&#34;&gt;&lt;/script&gt;&lt;br&gt;&#xA;&lt;p&gt;今回使おうと思っていたM5Stack Basicにはユニットを繋げられる穴が一つしかなかったのでハブも買いました。&lt;br&gt;&#xA;将来的にいっぱい繋げることも考えて6ポートに増やせるやつを選びました。&lt;br&gt;&#xA;チャンネルの取得制御の仕方はポーリング制御らしいです。&lt;/p&gt;&#xA;&lt;div class=&#34;iframely-embed&#34;&gt;&lt;div class=&#34;iframely-responsive&#34; style=&#34;height: 170px; padding-bottom: 0;&#34;&gt;&lt;a href=&#34;https://www.switch-science.com/products/7588&#34; data-iframely-url=&#34;//iframely.net/KDI2aRK&#34;&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;script async src=&#34;//iframely.net/embed.js&#34;&gt;&lt;/script&gt;&lt;br&gt;&#xA;&lt;hr&gt;&#xA;&lt;h1 id=&#34;4-1-速さが足りない---うっかりミス編&#34;&gt;4-1. 速さが足りない - うっかりミス編&lt;/h1&gt;&#xA;&lt;p&gt;ちょっと察しのいい方はすでに先ほど貼った商品ページのスペックからオチが予想できていたかもしれませんが&amp;hellip;&lt;/p&gt;</description>
    </item>
    <item>
      <title>M5Stackで始めるIoT開発入門〜学習リモコン〜</title>
      <link>https://DefiosLab.github.io/post/remote_contoroller_mqtt/</link>
      <pubDate>Tue, 20 Dec 2022 00:00:00 +0000</pubDate>
      <guid>https://DefiosLab.github.io/post/remote_contoroller_mqtt/</guid>
      <description>&lt;h1 id=&#34;1はじめに&#34;&gt;1．はじめに&lt;/h1&gt;&#xA;&lt;p&gt;本記事は、IoT開発初心者である私が&lt;strong&gt;M5Stackで学習リモコンを作成し、ネットワーク経由で家電を操作してみよう&lt;/strong&gt;という内容です。&lt;/p&gt;&#xA;&lt;p&gt;M5StackはWi-FiとBluetoothによる無線通信機能を備えたESP32や液晶ディスプレイ、microSDカードスロットなどの周辺機器がまとまった小型のマイコンモジュールです。ユニット(センサーなど)を接続することで簡単にセンサーから値を取得できます。この記事を通して、M5Stackでの開発やMQTTなど基本的なIoT開発の仕方を勉強するきっかけや参考になればいいと思います。&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h1 id=&#34;2開発環境と構成図&#34;&gt;2．開発環境と構成図&lt;/h1&gt;&#xA;&lt;p&gt;今回作成するシステムの構成図はこんな感じです。ただ、学習リモコンを作るだけではIoTにはならないので、ネットワーク経由でも操作できるようにしました。IoTでの通信といえばMQTTと聞いたので勉強も兼ねて実装していきたいと思います。&lt;/p&gt;&#xA;&lt;figure&gt;&lt;img src=&#34;https://DefiosLab.github.io/post/remote_contoroller_mqtt/IoT_system.png&#34;&#xA;    alt=&#34;システム構成図&#34; width=&#34;800px&#34;&gt;&#xA;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;開発環境は以下の通りです。M5GO IoTスターターキットを購入すれば、IRセンサーの他にENVⅢ(温湿度・気圧)センサーなども付いてくるので初めてIoT開発する方にはおすすめです。前提として、Arduino IDEでのM5Stackの環境は整っていることとします。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;端末：M5GO (M5STACK BASICでもOK)&lt;/li&gt;&#xA;&lt;li&gt;センサー：IRセンサー(赤外線センサー)&lt;/li&gt;&#xA;&lt;li&gt;サーバー：Raspberry Pi 4 (Linuxの入ったPCなら代替可)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;hr&gt;&#xA;&lt;h1 id=&#34;3学習リモコン作成&#34;&gt;3．学習リモコン作成&lt;/h1&gt;&#xA;&lt;h2 id=&#34;31準備&#34;&gt;3.1．準備&lt;/h2&gt;&#xA;&lt;p&gt;最初に学習リモコンから作成していきたいと思います。まずは、&lt;code&gt;IRremoteESP8266&lt;/code&gt;のライブラリをインストールします。&lt;/p&gt;&#xA;&lt;h2 id=&#34;32受信編&#34;&gt;3.2．受信編&lt;/h2&gt;&#xA;&lt;p&gt;次に既存のリモコンから赤外線データを取得します。今回私は、電気をON・OFFするこちらのアイリスオオヤマ製のリモコンを使用します。&lt;/p&gt;&#xA;&lt;figure&gt;&lt;img src=&#34;https://DefiosLab.github.io/post/remote_contoroller_mqtt/IRIS.png&#34;&#xA;    alt=&#34;システム構成図&#34; width=&#34;300px&#34;&gt;&#xA;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;まずは、&lt;code&gt;IRremoteESP8266&lt;/code&gt;のサンプルコードを取得します。&#xA;赤外線を受信するサンプルコードは、「ファイル」→「スケッチ例」→「IRremoteESP8266」の「IRrecvDumpV2」から取得できます。&lt;/p&gt;&#xA;&lt;figure&gt;&lt;img src=&#34;https://DefiosLab.github.io/post/remote_contoroller_mqtt/dump_sample.png&#34;&#xA;    alt=&#34;サンプルコード取得&#34; width=&#34;800px&#34;&gt;&#xA;&lt;/figure&gt;&#xA;&#xA;&lt;p&gt;M5GOでは、受信するPIN番号が36、送信するPIN番号が26番です。なので、受信するPIN番号を36に変更する必要があります。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;uint16_t&lt;/span&gt; kRecvPin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;36&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;変更したら、コンパイル＋書き込みを行い、シリアルモニターを開いてIRセンサーに向けてリモコンのボタンを押しデータ受信させます。今回は「ON・OFF」、「明るく」、「暗い」のデータを受信します。赤外線データを受信すると以下のようなにシリアルモニタに表示されるので&lt;code&gt;uint16_t raw_data[85]&lt;/code&gt;のメモを取ります。&#xA;&lt;figure&gt;&lt;img src=&#34;https://DefiosLab.github.io/post/remote_contoroller_mqtt/dump_result.png&#34;&#xA;    alt=&#34;受信結果&#34; width=&#34;800px&#34;&gt;&#xA;&lt;/figure&gt;&#xA;&lt;/p&gt;&#xA;&lt;h2 id=&#34;33送信編&#34;&gt;3.3．送信編&lt;/h2&gt;&#xA;&lt;p&gt;赤外線データを受信したら、次に学習リモコンを作成します。現時点では、Web UIやMQTTの実装はしていないので、ボタンが押された場合データを送信するように実装します。&#xA;Aボタンが「切/入」、Bボタンが「明るく」、Cボタンが「暗く」のデータを送信するように実装していきます。&#xA;コードについては、コード内にコメントを書いたので説明は省略します。コンパイル＋書き込みを行い、実際に家電(今回は電気)を操作できたら学習リモコンは完成です！&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-C&#34; data-lang=&#34;C&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;M5Stack.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;IRremoteESP8266.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#include&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;&amp;lt;IRsend.h&amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define DATA_SIZE 85 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 送信する赤外線データのサイズ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#define TRANSMIT_CAPTURE_SIZE 38 &lt;/span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 周波数. 赤外線リモコンの仕様が38khzなので、38で固定&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; ir_send_pin &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;26&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;// 送信するPIN番号&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;IRsend &lt;span style=&#34;color:#a6e22e&#34;&gt;irsend&lt;/span&gt;(ir_send_pin);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 送信する赤外線データ&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint16_t&lt;/span&gt; on_off[&lt;span style=&#34;color:#ae81ff&#34;&gt;85&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#ae81ff&#34;&gt;2022&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1004&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;5584&lt;/span&gt;,... , &lt;span style=&#34;color:#ae81ff&#34;&gt;1494&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;532&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt;};  &lt;span style=&#34;color:#75715e&#34;&gt;// 切/入&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint16_t&lt;/span&gt; brightly[&lt;span style=&#34;color:#ae81ff&#34;&gt;85&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#ae81ff&#34;&gt;2050&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;978&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;5586&lt;/span&gt;,...,  &lt;span style=&#34;color:#ae81ff&#34;&gt;1550&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;480&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;508&lt;/span&gt;};  &lt;span style=&#34;color:#75715e&#34;&gt;// 明るく&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint16_t&lt;/span&gt; dark[&lt;span style=&#34;color:#ae81ff&#34;&gt;85&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#ae81ff&#34;&gt;2020&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1006&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;5578&lt;/span&gt;,...,  &lt;span style=&#34;color:#ae81ff&#34;&gt;488&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;516&lt;/span&gt;,  &lt;span style=&#34;color:#ae81ff&#34;&gt;536&lt;/span&gt;};  &lt;span style=&#34;color:#75715e&#34;&gt;// 暗く&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;setup&lt;/span&gt;() {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// M5Stackの初期化&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  M5.&lt;span style=&#34;color:#a6e22e&#34;&gt;begin&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  M5.Power.&lt;span style=&#34;color:#a6e22e&#34;&gt;begin&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// 26番ピンの設定&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;pinMode&lt;/span&gt;(ir_send_pin, OUTPUT);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;digitalWrite&lt;/span&gt;(ir_send_pin, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;loop&lt;/span&gt;() {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  M5.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// 各ボタンが押された際に、それぞれの赤外線データを送信する&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (M5.BtnA.&lt;span style=&#34;color:#a6e22e&#34;&gt;wasPressed&lt;/span&gt;()) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    irsend.&lt;span style=&#34;color:#a6e22e&#34;&gt;sendRaw&lt;/span&gt;(on_off, DATA_SIZE, TRANSMIT_CAPTURE_SIZE);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (M5.BtnB.&lt;span style=&#34;color:#a6e22e&#34;&gt;wasPressed&lt;/span&gt;()) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    irsend.&lt;span style=&#34;color:#a6e22e&#34;&gt;sendRaw&lt;/span&gt;(brightly, DATA_SIZE, TRANSMIT_CAPTURE_SIZE);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  } &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (M5.BtnC.&lt;span style=&#34;color:#a6e22e&#34;&gt;wasPressed&lt;/span&gt;()) {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    irsend.&lt;span style=&#34;color:#a6e22e&#34;&gt;sendRaw&lt;/span&gt;(dark, DATA_SIZE, TRANSMIT_CAPTURE_SIZE);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;&#xA;&lt;h1 id=&#34;4mqtt&#34;&gt;4．MQTT&lt;/h1&gt;&#xA;&lt;p&gt;MQTT(Message Queue Telemetry Transport)とは、IoT向けのメッセージングプロトコルです。publish/subscribeモデルという仕組みに基づいており、双方向通信可能、非常に軽量で効率的なためIoTでの通信で用いられます。&#xA;publish/subscribeモデルでは、メッセージの送信側(Publisher)と受信側(Subscriber)の間にMQTTサーバー(Broker)が入ってメッセージを扱います。&lt;br&gt;&#xA;今回はMQTT Brokerとして、OSSであるMosquittoをRaspBerry Piにインストールしていきます。また、動作確認もしたいのでクライアントツールもインストールします。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
